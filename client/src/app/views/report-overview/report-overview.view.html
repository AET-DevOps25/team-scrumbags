<div class="flex gap-2 items-center">
  <button
    mat-icon-button
    aria-label="Back to report overview"
    [disabled]="!selectedReportId()"
    (click)="selectedReportId.set(undefined)"
  >
    <mat-icon>arrow_back</mat-icon>
  </button>
  <h2 class="text-xl font-semibold">
    {{selectedReport() ? selectedReport()!.name : "Reports"}}
  </h2>
</div>

<!-- switch between list and content -->
<div class="flex-1 overflow-y-auto">
  @if (selectedReportId()){
  <app-report-content [report]="selectedReport()!"></app-report-content>
  } @else {
  <app-report-list
    (selectedReportId)="selectedReportId.set($event)"
  ></app-report-list>
  }
</div>

<!-- Always show the form below -->
<div>
  @if (!showForm()) {
  <button
    mat-mini-fab
    color="primary"
    aria-label="Add report"
    (click)="displayForm()"
  >
    <mat-icon>add</mat-icon>
  </button>
  } @else {
  <form
    class="flex items-start justify-between rounded outline !outline-(--mat-sys-outline-variant) !shadow-(--mat-sys-level2) pt-4"
    (ngSubmit)="onSubmit()"
  >
    <button
      mat-icon-button
      type="button"
      (click)="onCancel()"
      aria-label="Cancel"
    >
      <mat-icon>close</mat-icon>
    </button>
    <div class="flex flex-wrap gap-x-4">
      <mat-form-field appearance="outline">
        <mat-label>Start Date</mat-label>
        <input
          matInput
          [matDatepicker]="startPicker"
          [(ngModel)]="periodStart"
          [max]="periodEnd() ? periodEnd() : now()"
          name="startDate"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="startPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>End Date</mat-label>
        <input
          matInput
          [matDatepicker]="endPicker"
          [(ngModel)]="periodEnd"
          [min]="periodStart()"
          [max]="now()"
          name="endDate"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="endPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Users</mat-label>
        <mat-select multiple [(ngModel)]="userIds" name="userIds">
          @for (user of possibleUsers(); track user.id) {
          <mat-option [value]="user.id">{{ user.username }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <button mat-icon-button color="primary" type="submit" aria-label="Send">
      <mat-icon>send</mat-icon>
    </button>
  </form>
  }
</div>
